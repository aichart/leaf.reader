{"version":3,"file":"index.9308a17f.js","sources":["../../../client/src/pages/book-shelf/book-shelf-item.tsx","../../../client/src/pages/book-shelf/index.tsx"],"sourcesContent":["import type { BookShelf } from \"@Shared/bookshelf\";\r\nimport { FC } from \"react\";\r\n\r\nexport interface BookShelfItemProps {\r\n  data: BookShelf.Item;\r\n  checked?: boolean;\r\n  onClick?: () => void;\r\n}\r\n\r\nexport const BookShelfItem: FC<BookShelfItemProps> = ({\r\n  data,\r\n  checked,\r\n  onClick\r\n}) => {\r\n  const coverUrl = data.coverUrl ?? 'img/img3.jpg';\r\n  const percent = (100 * data.chapterIndex / data.chapterLength).toFixed(0);\r\n  return (\r\n    <div className='relative flex flex-col w-24 text-xs cursor-pointer' onClick={onClick}>\r\n      <img src={coverUrl} className={`aspect-2/3 shadow-md shadow-gray-800 ${checked ? 'brightness-50' : ''} per`} />\r\n      <span className='dark:text-leaf-300 truncate mt-2'>{data.name}</span>\r\n      <span className='text-gray-400'>已阅读 {percent}%</span>\r\n      {\r\n        checked &&\r\n        <span className='check-box absolute right-1.5 top-1.5 w-3 bg-red-500'></span>\r\n      }\r\n    </div>\r\n  );\r\n};","import { FC, Fragment, useState } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { RoutePath } from \"@Client/routers\";\r\nimport { Toast } from '@Client/components/toast';\r\nimport SearchBar from '@Client/components/search-bar';\r\nimport TabBar from \"@Client/components/tab-bar\";\r\nimport { useAppDispatch, useAppSelector } from \"@Client/store\";\r\nimport { bookShelfSelector, remove } from \"@Client/store/features/slice.bookshelf\";\r\nimport { loadBook } from \"@Client/store/features/slice.book\";\r\nimport { bookSourceSelector } from \"@Client/store/features/slice.booksource\";\r\nimport { gotoChapter } from \"@Client/store/features/slice.book\";\r\nimport type { BookShelf } from \"@Shared/bookshelf\";\r\nimport { BookShelfItem } from './book-shelf-item';\r\n\r\n// 书架\r\nconst BookShelfPage: FC = () => {\r\n  const nav = useNavigate();\r\n  const { books } = useAppSelector(bookShelfSelector);\r\n  const booksourceList = useAppSelector(bookSourceSelector);\r\n  const dispath = useAppDispatch();\r\n\r\n  const [checkedBooks, setCheckedBooks] = useState<typeof books>([]);\r\n  const [edit, setEdit] = useState(false);\r\n\r\n  // book click\r\n  const onBookClick = (book: BookShelf.Item) => {\r\n    if(edit === true) {\r\n      onSelectBook(book);\r\n      return;\r\n    }\r\n    onOpenBook(book);\r\n  };\r\n\r\n  // 选中/反选 书籍\r\n  const onSelectBook = (book: BookShelf.Item) => {\r\n    if(checkedBooks.includes(book)) {\r\n      setCheckedBooks(checkedBooks.filter(value => book.bookUrl !== value.bookUrl));\r\n      return;\r\n    }\r\n    setCheckedBooks([...checkedBooks, book]);\r\n  };\r\n\r\n  // 打开书籍\r\n  const onOpenBook = (book: BookShelf.Item) => {\r\n    const { bookUrl, bookSource: booksourceURL, chapterIndex} = book;\r\n    const bookSource = booksourceList.find(value => value.url === booksourceURL);\r\n    if(bookSource === undefined) {\r\n      Toast.show('书源不存在！')\r\n      return;\r\n    }\r\n    dispath(loadBook({bookSource, bookUrl})).then(() => {\r\n      dispath(gotoChapter(chapterIndex));\r\n      nav(RoutePath.BookReader);\r\n    });\r\n  };\r\n\r\n  // ==================== edit action ====================\r\n\r\n  // 全选/全不选\r\n  const onAll = () => {\r\n    if(books.length === checkedBooks.length) {\r\n      setCheckedBooks([]);\r\n      return;\r\n    }\r\n    setCheckedBooks(books);\r\n  };\r\n\r\n  // 删除\r\n  const onDelete = () => {\r\n    if(checkedBooks.length === 0) {\r\n      return;\r\n    }\r\n    dispath(remove(checkedBooks));\r\n    onEditorCancel();\r\n  };\r\n\r\n  // 下载\r\n  const onDownload = () => {\r\n    Toast.show('敬请期待!');\r\n  };\r\n\r\n  // 分组\r\n  const onGroup = () => {\r\n    Toast.show('敬请期待!');\r\n  };\r\n\r\n  // 取消编辑\r\n  const onEditorCancel = () => {\r\n    setEdit(false);\r\n    setCheckedBooks([]);\r\n  }\r\n\r\n  // 前往搜索\r\n  const gotoSearch = () => nav(RoutePath.BookSearch);\r\n\r\n  return (\r\n    <Fragment>\r\n      {/* top */}\r\n      <div className='bg-leaf-secondary dark:bg-leaf-secondary-dark select-none'>\r\n        {/* search bar */}\r\n        <SearchBar placeholder='请输入书名或作者名' className='flex-grow mx-4 mt-3' onFocus={gotoSearch}>\r\n          {/* 触发下拉框，导入本地书籍 */}\r\n          <div className='btn rounded-none py-0 pr-0 font-bold border-l'>+</div>\r\n        </SearchBar>\r\n\r\n        {/* tab bar */}\r\n        {\r\n          !edit &&\r\n          <div className='flex items-center justify-between h-12'>\r\n            <TabBar items={[\r\n              {key: 1, title: '书架'},\r\n              {key: 2, title: '书单'},\r\n            ]} activeKey={1}/>\r\n\r\n            {/* 编辑 */}\r\n            <div className='btn text-xs space-x-1.5' onClick={() => setEdit(!edit)}>\r\n              <span className='check-box'></span>\r\n              <span>选择</span>\r\n            </div>\r\n          </div>\r\n        }\r\n\r\n        {/* option bar */}\r\n        {\r\n          edit &&\r\n          <div className='flex items-center h-12'>\r\n            <div className='btn text-sm w-24 py-1' onClick={onAll}>{checkedBooks.length === books.length ? '全部取消' : '全选'}</div>\r\n            <span className='flex-grow text-center text-sm'>\r\n              {\r\n                checkedBooks.length > 0 ? `已选择[${checkedBooks.length}/${books.length}]` : '选择书籍'\r\n              }\r\n            </span>\r\n            <div className='btn text-sm w-24 py-1' onClick={onEditorCancel}>取消</div>\r\n          </div>\r\n        }\r\n\r\n        {/* book group */}\r\n        <TabBar items={[\r\n          {key: 1, title: '默认'},\r\n          {key: 2, title: '未读'},\r\n          {key: 3, title: '已读'},\r\n          {key: 4, title: '垃圾箱'},\r\n        ]} activeKey={1} className='text-sm'/>\r\n      </div>\r\n\r\n\r\n\r\n      {/* bookshelf */}\r\n      <div className='flex-grow flex flex-wrap content-start items-start overflow-y-auto px-5 pt-2 gap-4 select-none'>\r\n        {\r\n          books.map(book => <BookShelfItem key={book.bookUrl} data={book} checked={checkedBooks.includes(book)} onClick={() => onBookClick(book)}/>)\r\n        }\r\n        { !edit && <div className='btn w-24 aspect-2/3 font-semibold text-4xl shadow-md shadow-gray-800' onClick={gotoSearch}>+</div> }\r\n      </div>\r\n\r\n\r\n      {/* bottom option bar */}\r\n      {\r\n        edit &&\r\n        <div className={`tab-bar text-sm ${checkedBooks.length === 0 ? ' pointer-events-none opacity-50' : ''}`}>\r\n          <button className='btn' onClick={onDownload}>下载</button>\r\n          <button className='btn' onClick={onGroup}>分组</button>\r\n          <button className='btn' onClick={onDelete}>删除</button>\r\n        </div>\r\n      }\r\n    </Fragment>\r\n  );\r\n}\r\n\r\nexport default BookShelfPage;\r\n"],"names":["BookShelfItem","data","checked","onClick","coverUrl","percent","chapterIndex","chapterLength","toFixed","className","children","_jsx","src","name","_jsxs","BookShelfPage","nav","useNavigate","books","useAppSelector","bookShelfSelector","booksourceList","bookSourceSelector","dispath","useAppDispatch","checkedBooks","setCheckedBooks","useState","edit","setEdit","onBookClick","book","onSelectBook","onOpenBook","includes","filter","value","bookUrl","bookSource","booksourceURL","find","url","undefined","Toast","show","loadBook","then","gotoChapter","RoutePath","BookReader","onAll","length","onDelete","remove","onDownload","onGroup","onEditorCancel","gotoSearch","BookSearch","Fragment","SearchBar","placeholder","onFocus","TabBar","items","key","title","activeKey","map"],"mappings":"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"}